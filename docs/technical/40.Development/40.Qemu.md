---
title: Qemu
sidebar_position: 40
---

## Prerequisites

- We assume you are using Ubuntu. Other OSs (MacOS/Windows) are not formally supported.

- Install tmux

   ```bash
   sudo apt install tmux
   ```

- We recommend install oh-my-tmux [here](https://github.com/namtzigla/oh-my-tmux)

   ```bash
   cd
   git clone https://github.com/gpakosz/.tmux.git
   ln -s -f .tmux/.tmux.conf
   cp .tmux/.tmux.conf.local .
   ```

## Run

:::warning Remember you need tmux for this step
:::

Open a new terminal and run:

```bash
make dev qemu
```

This should launch a tmux session with 4 panes:

<img src="/img/qemu-tmux.png" alt="drawing" width="800"/>

- **Top pane**: QEMU
- **Left pane**: Rich execution environment (`telnet localhost 54320`)
- **Right pane**: Secure execution environment (`telnet localhost 54321`
- **Bottom pane**: Bitbake

You can start the emulator by typying `c <ENTER>` in the top pane.

You will then see the "machine" booting. After a few seconds, you will see a login prompt on the left pane.

:::tips tmux Tips

- If you installed oh-my-tmux, your prefix will be `<CTRL>+A` otherwise, it will be `<CTRL>+B`

- To close everything use `<PREFIX> + &`, the answer `y`

:::

## Development

Let's assume you are working on the hello-rustee example. This is located in the `hellorustee` recipe.

```bash
make workspace qemu hello-rustee
```

This command will checkout the source code of the recipe in `sources/hello-rustee`.

You can now start working there (even switch branches or commit changes!)

### Build your changes

Go to the bitbake window (bottom pane) and build the recipe:

```bash
bitbake hello-rustee
```

This will trigger a minimal image rebuild, after which you should see something like this in the bitbake panel:

```
Build Configuration:
BB_VERSION           = "1.52.0"
BUILD_SYS            = "x86_64-linux"
NATIVELSBSTRING      = "universal"
TARGET_SYS           = "aarch64-poky-linux"
MACHINE              = "qemu-optee64"
DISTRO               = "zondbox-distro"
DISTRO_VERSION       = "3.4.1"
TUNE_FEATURES        = "aarch64 armv8a crc cortexa57"
TARGET_FPU           = ""
meta                 
meta-poky            
meta-yocto-bsp       = "HEAD:09296dca79c2c1de3d440b6374f949f8b8faca40"
meta-oe              
meta-python          = "HEAD:f632403d1800363ac63a1ad5543278b82c659832"
workspace            = "<unknown>:<unknown>"
meta-zondax-qemu     = "HEAD:278a73f29b859bdd52bf85dcdf85cb9a9c034107"
meta-zondax          = "HEAD:795094163436c067ac9694a29d17ef648b5f6dbe"

Initialising tasks: 100% |#####################################################################################################################################| Time: 0:00:00
Sstate summary: Wanted 0 Local 0 Network 0 Missed 0 Current 173 (0% match, 100% complete)
NOTE: Executing Tasks
WARNING: hello-rustee-0.1-r0 do_populate_lic: /usr/lib/python3.8/ast.py:371: PendingDeprecationWarning: visit_Str is deprecated; add visit_Constant
  return visitor(node)

NOTE: hello-rustee: compiling from external source tree /home/zondax_circle/shared/zondbox-distro/build/workspace/sources/hello-rustee
NOTE: Tasks Summary: Attempted 728 tasks of which 717 didn't need to be rerun and all succeeded.

Summary: There was 1 WARNING message shown.
```
In this case there were not errors and you can be sure that your changes
wont cause compilation issues.

## Testing

Let's say that you want to test your changes without having to restart the emulator. :)

In this case, you can mount the local filesystem inside the emulator.

:::tip 
You should have already started the emulator and booted the image!
:::

In the left pane, login as root and type:

```bash
cd /mnt
```

:::warning
Complete local testing tricks
:::
